---
title: Preprocessing
params:
  base_config: "ss"
---

This will contain the preprocessing steps.

```{r}
#| label: setup

# If running code interactively in rstudio, set profile here
# When rendering with quarto, profile is already set and should not be overwritten
if (nchar(Sys.getenv("QUARTO_PROFILE")) == 0) {
  Sys.setenv("QUARTO_PROFILE" = "default")
}
  
param = function(p=NULL) {
  # read document params yaml
  current_params = params
  
  # if profile is set, read profile params from the profile yaml file and merge
  profile = Sys.getenv("QUARTO_PROFILE")
  profile_params = list()
  
  if (nchar(profile) > 0) {
    profile_yml = yaml::read_yaml(paste0("_quarto-", profile, ".yml"))
    if ("params" %in% names(profile_yml)) {
      current_params = purrr::list_modify(profile_yml$params, !!!current_params)
    }
  }
  
  if(is.null(p)) {
    return(current_params)
  } else {
    assertthat::assert_that(p %in% names(current_params),
                            msg=FormatMessage("Parameter {p} is not set."))
    
    return(current_params[[p]])
  }
}

param()
```


Blah Blah [see @Xie_2015]
